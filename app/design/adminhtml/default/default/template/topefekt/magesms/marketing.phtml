<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2015 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $this->profile->user; ?><?php $lang = $this->profile->lang; ?><h2><?php echo Mage::helper('magesms')->__('SMS Marketing - customers found: '); ?><span id="magesms-marketing-countit"><?php echo $this->getCollection()->count(); ?></span></h2><p><?php echo Mage::helper('magesms')->__('Write text of message and use advanced filter to target your marketing campaign.'); ?></p><div id="magesms"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminTools.gif'; ?>" alt="" /><?php echo Mage::helper('magesms')->__('SMS Marketing - bulk SMS text'); ?></h4><span class="right"><a href="<?php echo Mage::helper("adminhtml")->getUrl('*/*/template', array('action'=>'saveTemplate', 'type' => 1)); ?>" title="<?php echo Mage::helper('magesms')->__('Save template'); ?>" onclick="showPopup(this);return false;">[<?php echo Mage::helper('magesms')->__('Save template'); ?>]</a>&nbsp;&nbsp;&nbsp;<a href="<?php echo Mage::helper("adminhtml")->getUrl('*/*/template', array('action'=>'loadTemplate', 'type' => 1)); ?>" title="<?php echo Mage::helper('magesms')->__('Saved Templates'); ?>" onclick="showPopup(this);return false;">[<?php echo Mage::helper('magesms')->__('Saved Templates'); ?>]</a></span></div><div class="fieldset"><form name="formSMS" id="magesms_sendsms" action="<?php echo Mage::helper("adminhtml")->getUrl('*/*/sent') ?>" enctype="multipart/form-data" method="post"><input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" /><input name="filter" type="hidden" value="<?php echo $this->getRequest()->getParam('filter'); ?>" /><div style="float: left;margin-right:30px;width:450px"><label for="text"><?php echo Mage::helper('magesms')->__('Enter SMS text'); ?></label><br /><div class="margin-form"><textarea name="text" id="text" class="required-entry input-text" style="width:420px; height:135px;"><?php echo $this->getSmsData()->getData('text'); ?></textarea></div><div class="clear"></div></div><div style="float: left;margin-right:30px;"><label for="text"><?php echo Mage::helper('magesms')->__('Preview'); ?> (<span id="labelSMS"></span>)</label><br /><div class="margin-form"><textarea name="textfake" id="textfake" disabled="disabled" class="required-entry input-text" style="width:420px; height:135px;border:1px solid grey;"></textarea></div><div class="clear"></div></div><div style="float: left;margin:1.5em 0;"><div class="margin-form"><input id="unicode" type="checkbox" value="1" name="unicode" <?php echo $this->getSmsData()->getData('unicode') ? 'checked' : ''; ?> /><label for="unicode"><?php echo Mage::helper('magesms')->__(' Unicode '); ?></label><span style="cursor:help;text-decoration:underline;" title="<?php echo Mage::helper('magesms')->__('Check only if you want to use Chinese, Arabic, Greek, Hebrew, Korean, Cyrillic, etc. or diacritic in the text of your SMS message (Unicode text allows you to insert characters in all fonts and various other symbols simultaneously. Number of characters in one SMS will be reduced to 70).'); ?>" onclick="popup_title(this)">?</span></div><div class="margin-form"><input type="hidden" value="0" name="unique" /><input id="unique" type="checkbox" value="1" name="unique" <?php echo $this->getSmsData()->getData('unique') === '0' ? '' : 'checked'; ?> /><label for="unique"><?php echo Mage::helper('magesms')->__('Remove duplicate numbers'); ?></label></div><div class="margin-form" style="margin-top: 10px"><input id="sendlater" type="checkbox" value="1" onchange="sendlaterx(this)" name="sendlater" <?php echo $this->getSmsData()->getData('sendlater') ? 'checked' : ''; ?> /><label for="sendlater"><?php echo Mage::helper('magesms')->__(' Send later '); ?></label></div><div class="margin-form sendlater-form" id="sendlater-form" style="display: none; padding: 5px 0 0 20px"><label for="date"><?php echo Mage::helper('magesms')->__('Date:'); ?></label><?php $datumodesl = Mage::helper('core')->formatDate( ($_x = $this->getSmsData()->getData('datumodesl')) ? $_x.date(' H:i:s', Mage::getModel('core/date')->timestamp(time())) : date('Y-m-d H:i:s', Mage::getModel('core/date')->timestamp(time())+24*60*60), 'short', false); ?><input type="text" style="width: 100px;" class="input-text validate-sendlater-datumodesl" value="<?php echo $datumodesl; ?>" id="datumodesl" name="datumodesl"/><img style="cursor:pointer" title="<?php echo Mage::helper('magesms')->__('Calendar'); ?>" id="date_select_trig" class="v-middle" alt="" src="<?php echo $this->getSkinUrl("images/grid-cal.gif");?> "/>&nbsp;&nbsp;&nbsp;&nbsp;<label for="date"><?php echo Mage::helper('magesms')->__('Time: '); ?></label><select name="datumodesl_hour"><?php for($hour=1;$hour<=24;$hour++): ?><option value="<?php echo $hour; ?>" <?php echo (($_x = $this->getSmsData()->getData('datumodesl_hour')) ? $_x : 9 ) == $hour ? 'selected' : ''; ?>><?php printf('%02d', $hour); ?></option><?php endfor; ?></select>:<select name="datumodesl_min"><?php for($min=0;$min<=59;$min++): ?><option value="<?php echo $min; ?>" <?php echo $this->getSmsData()->getData('datumodesl_min') == $min ? 'selected' : ''; ?>><?php printf('%02d', $min); ?></option><?php endfor; ?></select><script type="text/javascript">//<![CDATA[
function sendlaterx(obj) {if (obj.checked == true) {$('sendlater-form').show();} else {$('sendlater-form').hide();}}sendlaterx($('sendlater'));Calendar.setup({inputField: "datumodesl",ifFormat: "<?php echo Mage::app()->getLocale()->getDateStrFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT); ?>",button: "date_select_trig",align: "Bl",singleClick : true});
//]]></script><div class="margin-form" style="padding: 5px 0 0 0"><label for="datereal"><?php echo Mage::helper('magesms')->__('Your time: '); ?></label><?php $date = Mage::app()->getLocale()->date()->toString(); ?><select id="datereal" name="datereal"><option value="-1" <?php echo $this->getSmsData()->getData('datereal') == -1 ? 'selected' : ''; ?>><?php echo $date; ?> -<?php echo Mage::helper('magesms')->__('1hr'); ?></option><option value="0" <?php echo $this->getSmsData()->getData('datereal', 0) == 0 ? 'selected' : ''; ?>><?php echo $date; ?></option><option value="1" <?php echo $this->getSmsData()->getData('datereal') == 1 ? 'selected' : ''; ?>><?php echo $date; ?> +<?php echo Mage::helper('magesms')->__('1hr'); ?></option></select>&nbsp;&nbsp;&nbsp;&nbsp;(<?php echo Mage::helper('magesms')->__('time zone: '); ?><span style="cursor:help;" title="<?php echo Mage::helper('magesms')->__('time zone settings'); ?>"><a href="<?php echo Mage::helper("adminhtml")->getUrl('adminhtml/system_config/edit/section/general/', array('_fragment' => 'general_locale-head')); ?>" target="_blank"><?php echo Mage::app()->getStore()->getConfig('general/locale/timezone'); ?></a></span>)</div></div></div><div class="clear"></div><div style="float: left;margin-right:30px;width:450px"><span style="font-size:10px;"><?php echo Mage::helper('magesms')->__('Possible variables:'); ?><br /><div class="translate_notice"><?php echo $this->getNotice(); ?></div></span><div class="clear"></div><div class="coupons" style="margin-top: 5px"><?php echo Mage::helper('magesms')->__('Select coupon'); ?>:<select id="coupon" name="coupon" onchange="couponSelect(this)"><?php foreach($this->getCoupons() as $coupon): ?><option value="<?php echo $coupon['rule_id']; ?>"><?php echo $coupon['name']; ?></option><?php endforeach; ?></select><a href="<?php echo Mage::helper("adminhtml")->getUrl('adminhtml/promo_quote/new/'); ?>"><?php echo Mage::helper('magesms')->__('Create coupon'); ?></a><div class="clear"></div><span style="display:none;" id="coupon_notice"><div class="translate_notice"><?php echo $this->getCouponsNotice(); ?></div></span></div></div><div class="margin-form" style="margin-top:50px"><button type="button" onclick="sendForm.submit();" title="<?php echo Mage::helper('magesms')->__('Send'); ?>" name="submitSend" class="form-button" /><span><span><span><?php echo Mage::helper('magesms')->__('Send'); ?></span></span></span></button><!--<input type="button" onclick="sendForm.submit();" value="<?php echo Mage::helper('magesms')->__('Send'); ?>" name="submitSend" class="form-button" />--></div></form></div></div><script type="text/javascript">//<![CDATA[
var sendForm = new varienForm('magesms_sendsms', '<?php echo Mage::helper("adminhtml")->getUrl('*/*/send') ?>');sendForm.submit = function() {if (this.validator.validate()) {if (confirm('<?php echo Mage::helper('magesms')->__('Send').' '.Mage::helper('magesms')->__('SMS').'?'; ?>')) {varienForm.prototype.submit.bind(this)();}return false;}};Validation.add('validate-sendlater-datumodesl','Please enter a valid date.', function(v) {return !$('sendlater').checked || $('sendlater').checked && !Validation.get('IsEmpty').test(v);});countitSMS = new countitSMS(document.getElementById('textfake'), document.getElementById('unicode'), document.getElementById('labelSMS'));countitSMS.chartext1 = '<?php echo Mage::helper('magesms')->__('Characters: '); ?>';countitSMS.chartext2 = '<?php echo Mage::helper('magesms')->__('total sms: '); ?>';countitSMS.alert = '';countitSMS.translate = {<?php echo $this->getTranslate(); ?>};countitSMS.copyFrom = document.getElementById('text');countitSMS.marketingCustomers = '<?php echo Mage::helper('magesms')->__('Total customers:'); ?>';countitSMS.marketingTotal = '<?php echo Mage::helper('magesms')->__('Total SMS:'); ?>';$('text').onkeyup = function() {countitSMS.count();};Event.observe(window, "load", function() {countitSMS.marketingCount = '<?php echo $this->getCollection()->count(); ?>';countitSMS.count();countitSMS.help(document.getElementsByClassName('translate_notice'));});function couponSelect(obj) {var style = document.getElementById('coupon_notice').style;if (obj.value) {style.display = 'block';} else {style.display = 'none';}}
//]]></script></div>