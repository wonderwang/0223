<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2015 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $this->profile->user; ?><?php $lang = $this->profile->lang; ?><h2><?php echo Mage::helper('magesms')->__('Send SMS'); ?></h2><p><?php echo Mage::helper('magesms')->__('Send SMS or bulk SMS. Enter mobile numbers or upload CSV file.'); ?></p><div id="magesms"><form name="formSMS" id="magesms_sendsms" action="<?php echo Mage::helper("adminhtml")->getUrl('*/*/send') ?>" enctype="multipart/form-data" method="post"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminTools.gif'; ?>" alt="" /> <?php echo Mage::helper('magesms')->__('Bulk SMS text'); ?></h4><span class="right"><a href="<?php echo Mage::helper("adminhtml")->getUrl('*/*/template', array('action'=>'saveTemplate')); ?>" title="<?php echo Mage::helper('magesms')->__('Save template'); ?>" onclick="showPopup(this);return false;">[<?php echo Mage::helper('magesms')->__('Save template'); ?>]</a>&nbsp;&nbsp;&nbsp;<a href="<?php echo Mage::helper("adminhtml")->getUrl('*/*/template', array('action'=>'loadTemplate')); ?>" title="<?php echo Mage::helper('magesms')->__('Saved Templates'); ?>" onclick="showPopup(this);return false;">[<?php echo Mage::helper('magesms')->__('Saved Templates'); ?>]</a></span></div><div class="fieldset"><input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" /><div style="float: left;margin-right:30px;width:450px"><label for="text"><?php echo Mage::helper('magesms')->__('Enter SMS text'); ?></label><br /><div class="margin-form"><textarea name="text" id="text" class="required-entry input-text" style="width:420px; height:135px;"><?php echo $this->getRequest()->getParam('text'); ?></textarea></div><div class="clear"></div><span style="font-size:10px;"><?php echo Mage::helper('magesms')->__('Possible variables:'); ?><br /></span><?php echo $this->getSelectStore(); ?><span style="font-size:10px;"><div id="notice"><?php echo $this->getNotice(); ?></div></span></div><div style="float: left;margin-right:30px;"><label for="text"><?php echo Mage::helper('magesms')->__('Preview'); ?> (<span id="labelSMS"></span>)</label><br /><div class="margin-form"><textarea name="textfake" id="textfake" disabled="disabled" class="required-entry input-text" style="width:420px; height:135px;border:1px solid grey;"></textarea></div></div><div style="float: left;margin-top:1.5em;"><div class="margin-form"><input id="unicode" type="checkbox" value="1" name="unicode" <?php echo $this->getRequest()->getParam('unicode') ? 'checked' : ''; ?> /><label for="unicode"><?php echo Mage::helper('magesms')->__(' Unicode '); ?></label><span style="cursor:help;text-decoration:underline;" title="<?php echo Mage::helper('magesms')->__('Check only if you want to use Chinese, Arabic, Greek, Hebrew, Korean, Cyrillic, etc. or diacritic in the text of your SMS message (Unicode text allows you to insert characters in all fonts and various other symbols simultaneously. Number of characters in one SMS will be reduced to 70).'); ?>" onclick="popup_title(this)">?</span></div><div class="margin-form"><input type="hidden" value="0" name="unique" /><input id="unique" type="checkbox" value="1" name="unique" <?php echo $this->getRequest()->getParam('unique') === '0' ? '' : 'checked'; ?> /><label for="unique"><?php echo Mage::helper('magesms')->__('Remove duplicate numbers'); ?></label></div><div class="margin-form" style="margin-top: 10px"><input id="sendlater" type="checkbox" value="1" onchange="sendlaterx(this)" name="sendlater" <?php echo $this->getRequest()->getParam('sendlater') ? 'checked' : ''; ?> /><label for="sendlater"><?php echo Mage::helper('magesms')->__(' Send later '); ?></label></div><div class="margin-form sendlater-form" id="sendlater-form" style="display: none; padding: 5px 0 0 20px"><label for="date"><?php echo Mage::helper('magesms')->__('Date:'); ?></label><input type="text" style="width: 100px;" class="input-text validate-sendlater-datumodesl" value="<?php echo $this->getRequest()->getParam('datumodesl', Mage::app()->getLocale()->date(Mage::getModel('core/date')->timestamp()+24*60*60, null, null, false)->toString(Mage::app()->getLocale()->getDateFormat(Mage_Core_Model_Locale::FORMAT_TYPE_MEDIUM))); ?>" id="datumodesl" name="datumodesl"/><img style="cursor:pointer" title="<?php echo Mage::helper('magesms')->__('Calendar'); ?>" id="date_select_trig" class="v-middle" alt="" src="<?php echo $this->getSkinUrl("images/grid-cal.gif");?> "/>&nbsp;&nbsp;&nbsp;&nbsp;<label for="date"><?php echo Mage::helper('magesms')->__('Time: '); ?></label><select name="datumodesl_hour"><?php for($hour=1;$hour<=24;$hour++): ?><option value="<?php echo $hour; ?>" <?php echo $this->getRequest()->getParam('datumodesl_hour', 9) == $hour ? 'selected' : ''; ?>><?php printf('%02d', $hour); ?></option><?php endfor; ?></select>:<select name="datumodesl_min"><?php for($min=0;$min<=59;$min++): ?><option value="<?php echo $min; ?>" <?php echo $this->getRequest()->getParam('datumodesl_min', 00) == $min ? 'selected' : ''; ?>><?php printf('%02d', $min); ?></option><?php endfor; ?></select><script type="text/javascript">//<![CDATA[
function sendlaterx(obj) {if (obj.checked == true) {$('sendlater-form').show();} else {$('sendlater-form').hide();}}sendlaterx($('sendlater'));Calendar.setup({inputField: "datumodesl",ifFormat: "<?php echo Mage::app()->getLocale()->getDateStrFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT); ?>",button: "date_select_trig",align: "Bl",singleClick : true});
//]]></script><div class="margin-form" style="padding: 5px 0 0 0"><label for="datereal"><?php echo Mage::helper('magesms')->__('Your time: '); ?></label><?php $date = Mage::app()->getLocale()->date()->toString(); ?><select id="datereal" name="datereal"><option value="-1" <?php echo $this->getRequest()->getParam('datereal') == -1 ? 'selected' : ''; ?>><?php echo $date; ?> -<?php echo Mage::helper('magesms')->__('1hr'); ?></option><option value="0" <?php echo $this->getRequest()->getParam('datereal', 0) == 0 ? 'selected' : ''; ?>><?php echo $date; ?></option><option value="1" <?php echo $this->getRequest()->getParam('datereal') == 1 ? 'selected' : ''; ?>><?php echo $date; ?> +<?php echo Mage::helper('magesms')->__('1hr'); ?></option></select>&nbsp;&nbsp;&nbsp;&nbsp;(<?php echo Mage::helper('magesms')->__('time zone: '); ?><span style="cursor:help;" title="<?php echo Mage::helper('magesms')->__('time zone settings'); ?>"><a href="<?php echo Mage::helper("adminhtml")->getUrl('adminhtml/system_config/edit/section/general/', array('_fragment' => 'general_locale-head')); ?>" target="_blank"><?php echo Mage::app()->getStore()->getConfig('general/locale/timezone'); ?></a></span>)</div></div></div></div></div><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminEmployees.gif'; ?>" alt="" /><?php echo Mage::helper('magesms')->__('Add recipients '); ?><span style="cursor:help;text-decoration:underline;" title="<?php echo Mage::helper('magesms')->__('Add one or more recipients separated by commas. Number must be in international format, no leading zeros or “+“ sign.'); ?>" onclick="popup_title(this)">?</span>&nbsp;<?php echo Mage::helper('magesms')->__(' (e.g. 447971796595)'); ?></h4></div><div class="fieldset"><div style="float: left;margin-right: 30px;"><div class="margin-form"><textarea id="recipients" name="recipients" class="input-text validate-recipients-file" style="width:420px; height:150px;"><?php echo $this->getRequest()->getParam('recipients'); ?></textarea></div></div><div style="float: left;"><div class="margin-form"><?php echo Mage::helper('magesms')->__('Add recipients in CSV(.csv, .txt) or vCARD(.vcf)'); ?><span style="cursor:help;text-decoration:underline;" title="<?php echo Mage::helper('magesms')->__('CSV file - 1 column, 1st column - number (Number must be in international format, no leading zeros or “+“ sign; e.g. 447971796595)'); ?>" onclick="popup_title(this)">?</span><br /><input type="file" id="sms_file" name="sms_file" /></div><div id="add_recipient"><?php $_alphabet = Mage::helper('magesms')->__('lang_alphabet'); $alphabet = explode(';', $_alphabet); if ($alphabet[0] == 'lang_alphabet') { $alphabet = range('A', 'Z'); } ?><a href="#" onclick="alphabet.toggle(); alphabet.load('<?php echo $alphabet[0]; ?>'); return false;"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminEmployees.gif'; ?>" alt="" /> <?php echo Mage::helper('magesms')->__('Add recipients '); ?></a><div style="display:none;" id="recipient-popup"><div class="popup-close" onclick="alphabet.toggle()">X</div><div class="popup-alphabet"><?php foreach ($alphabet as $char): ?><a href="#" title="<?php echo $char; ?>" onclick="return alphabet.load('<?php echo $char; ?>')"><?php echo $char; ?></a><?php endforeach; ?></div><div id="popup-output"></div></div></div></div><div class="clear"></div><script type="text/javascript">//<![CDATA[
alphabet = new magesmsAddRecipient(document.getElementById('recipient-popup'), document.getElementById('popup-output'), document.getElementById('recipients'));alphabet.setServiceUrl('<?php echo Mage::helper("adminhtml")->getUrl('*/*/loadCustomers') ?>');alphabet.setTranslate({notfound: '<?php echo Mage::helper('magesms')->__('not found'); ?>'});
//]]></script><div class="clear"></div><div class="margin-form" style="margin-left:500px"><button type="button" onclick="sendForm.submit();" title="<?php echo Mage::helper('magesms')->__('Send'); ?>" name="submitSend" class="form-button" /><span><span><span><?php echo Mage::helper('magesms')->__('Send'); ?></span></span></span></button><!--<input type="button" onclick="sendForm.submit();" value="<?php echo Mage::helper('magesms')->__('Send'); ?>" name="submitSend" class="form-button" />--></div></div></div></form><script type="text/javascript">//<![CDATA[
var sendForm = new varienForm('magesms_sendsms');sendForm.submit = function() {if (this.validator.validate()) {if (confirm('<?php echo Mage::helper('magesms')->__('Send').' '.Mage::helper('magesms')->__('SMS').'?'; ?>')) {varienForm.prototype.submit.bind(this)();}return false;}};Validation.add('validate-sendlater-datumodesl','Please enter a valid date.', function(v) {return !$('sendlater').checked || $('sendlater').checked && !Validation.get('IsEmpty').test(v);});Validation.add('validate-recipients-file','No recipient!', function(v) {return $('sms_file').value || !Validation.get('IsEmpty').test(v);});Translator.add('No recipient!','<?php echo Mage::helper('magesms')->__('Recipients found: 0')?>');countitSMS = new countitSMS(document.getElementById('textfake'), document.getElementById('unicode'), document.getElementById('labelSMS'));countitSMS.chartext1 = '<?php echo Mage::helper('magesms')->__('Characters: '); ?>';countitSMS.chartext2 = '<?php echo Mage::helper('magesms')->__('SMS: '); ?>';countitSMS.translate = {<?php echo $this->getTranslate(); ?>};countitSMS.copyFrom = document.getElementById('text');countitSMS.alert = '<?php echo Mage::helper('magesms')->__('Text is too long'); ?>';countitSMS.count();$('text').onkeyup = function() {countitSMS.count();};Event.observe(window, "load", function() {countitSMS.count();countitSMS.help(document.getElementById('notice'));});
//]]></script></div>