<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2015 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $routes = Mage::getSingleton('adminhtml/session')->getData('routes'); ?><h2><?php if ($routes->getSendertype() == 0): ?><?php echo Mage::helper('magesms')->__('SMS Settings - Select Text sender ID for '); ?><?php elseif ($routes->getSendertype() == 2): ?><?php echo Mage::helper('magesms')->__('SMS Settings - Select Own number sender ID for '); ?><?php else: return; ?><?php endif; ?><?php echo $routes->getAreaText(); ?></h2><div id="magesms"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminTools.gif'; ?>" alt="" /><?php if ($routes->getSendertype() == 0): ?><?php echo Mage::helper('magesms')->__('Text sender ID settings'); ?><?php else: ?><?php echo Mage::helper('magesms')->__('Own number sender ID settings'); ?><?php endif; ?></h4></div><div class="fieldset grid"><form id="magesms_sender" action="<?php echo $this->getUrl('*/*/savesender') ?>" method="post" onkeypress="return event.keyCode != 13;"><input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" /><?php if ($routes->getSendertype() == 0): ?><?php $senders = Mage::getSingleton('magesms/textsender')->getCollection(); $prefix = ''; $first = Mage::helper('magesms')->__('Text sender ID'); $label1 = Mage::helper('magesms')->__('Existing Text sender ID:'); $label2 = Mage::helper('magesms')->__('New Text sender ID:'); $maxlength = 11; $desc = Mage::helper('magesms')->__('max. 11 characters'); ?><?php else: ?><?php $senders = Mage::getSingleton('magesms/ownnumbersender')->getCollection(); $prefix = '+'; $first = Mage::helper('magesms')->__('Own number sender ID'); $label1 = Mage::helper('magesms')->__('Existing Own number:'); $label2 = Mage::helper('magesms')->__('New Own number sender ID:'); $maxlength = 30; $desc = Mage::helper('magesms')->__('in international format, no leading <br />zeros or a “+” sign, e.g., 447971796595'); ?><?php endif; ?><?php if ($routes->displayCode === true): ?><div class="margin-form" id="senderx"><label class="form-required" for="newsender"><?php echo $label2; ?> <span class="required">*</span></label><?php echo $routes->getData('senderID'); ?></div><div class="margin-form"><label class="form-required" for="code"><?php echo Mage::helper('magesms')->__('SMS code:'); ?> <span class="required">*</span></label><input class="required-entry validate-sender input-text" type="text" name="code" id="code" value="" /></div><?php else: ?><?php if ($senders->count()): ?><div class="margin-form"><label class="form-required" for="sender"><?php echo $label1; ?> <span class="required">*</span></label><select class="" name="sender" id="sender"><option value="">-><?php echo $first; ?></option><?php foreach($senders as $sender): ?><option value="<?php echo $sender->getVal(); ?>"><?php echo $prefix.$sender->getVal(); ?></option><?php endforeach; ?></select></div><?php endif; ?><div class="margin-form" id="senderx"><label class="form-required" for="newsender"><?php echo $label2; ?> <span class="required">*</span></label><input class="required-entry validate-sender input-text" maxlength="<?php echo $maxlength; ?>" type="text" name="newsender" id="newsender" value="" /><p><?php echo $desc; ?></p></div><?php endif; ?><div class="margin-form"><input type="button" onclick="senderForm.submit();" value="<?php echo Mage::helper('magesms')->__('CONFIRM'); ?>" class="form-button" /></div></form><script type="text/javascript">//<![CDATA[
var senderForm = new varienForm('magesms_sender', '<?php echo Mage::helper("adminhtml")->getUrl('*/*/validatesender'); ?>');<?php if ($routes->getSendertype() == 0): ?>Validation.add('validate-sender','possible characters: ', function(v) {return Validation.get('IsEmpty').test(v) || v.length >= 3 && /^[0-9a-zA-Z_.]+$/.test(v) && !/^[0-9]+$/.test(v);});Translator.add('possible characters: ','<?php echo Mage::helper('magesms')->__('possible characters: ').'a-z A-Z 0-9 _ .'; ?>');<?php else: ?>Validation.add('validate-sender','own number sender ID must be number', function(v) {return Validation.get('IsEmpty').test(v) || /^[1-9]+[0-9]+$/.test(v);});Translator.add('own number sender ID must be number','<?php echo Mage::helper('magesms')->__('own number sender ID must be number'); ?>');<?php endif; ?>Event.observe(window, "load", function() {$('sender').onchange = function(el) {console.log(this.value);if (this.value) {$('senderx').hide();$(this).addClassName('required-entry');$('newsender').removeClassName('required-entry');} else {$('senderx').show();$('newsender').focus();$(this).removeClassName('required-entry');$('newsender').addClassName('required-entry');}};});
//]]></script></div></div></div>