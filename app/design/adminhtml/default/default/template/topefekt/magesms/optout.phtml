<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2015 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $this->profile->user; ?><?php $lang = $this->profile->lang; ?><h2><?php echo Mage::helper('magesms')->__('SMS opt-out - setting SMS opt-out option from the cart and SMS charging'); ?></h2><p><?php echo Mage::helper('magesms')->__('Select an online store for which you want to set in the cart option to unsubscribe SMS notifications, setup cost of SMS messages and define the text that is displayed to the customer in the cart.'); ?></p><div id="magesms"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminTools.gif'; ?>" alt="" /> <?php echo Mage::helper('magesms')->__('Your online stores'); ?></h4></div><div class="fieldset grid"><table class="data"><col /><col width="50" /><?php $even = 1; foreach(Mage::app()->getWebsites($this->_isAdminScopeAllowed) as $website): if ($even) $even = 0; else $even = 1;?><?php $stores = $website->getStoreIds(); $product = Mage::getResourceModel('catalog/product_collection') ->addFieldToFilter('sku', Mage::getConfig()->getNode('default/config/optout')->sku) ->addWebsiteFilter($website->getId()) ->addAttributeToSelect('name') ->addAttributeToSelect('price') ->joinAttribute( 'status', 'catalog_product/status', 'entity_id', null, 'inner', reset($stores)) ->getFirstItem(); if (!count($stores)) continue; $auto = Mage::getResourceModel('catalog/product')->getAttributeRawValue($product->getId(), 'magesms_optout', reset($stores)); $websiteEnable = Mage::app()->getWebsite($website->getId())->getConfig('magesms/magesms/enable'); ?><tr id="hist_<?php echo $website->getId(); ?>" class="hover <?php if ($even) echo 'even'?>"><td><span class="img"><img class="toggle" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/i_plus.gif'; ?>"></span><span class="img" style="display:none"><img class="toggle" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/i_minus.gif'; ?>"></span><?php echo $website->getName(); ?><?php if ($_tmp = Mage::getStoreConfig('general/store_information/name', reset($stores))) { echo " ($_tmp"; $i = 0; foreach($website->getGroups() as $group) { echo $i ? ', ' : ' - '; echo '<span>'.$group->getName().'</span>'; $i++; } echo ')'; } ?></td><td class="a-center"><?php if ($product->getId() && $product->getStatus() == Mage_Catalog_Model_Product_Status::STATUS_ENABLED) { $img = 'i_accepted.gif'; $title = Mage::helper('magesms')->__('SMS opt-out is ACTIVE'); } else { $img = 'i_canceled.gif'; $title = Mage::helper('magesms')->__('SMS opt-out is NOT ACTIVE. To activate SMS opt-out check the checkbox „Activate displaying SMS opt-out feature in the cart“'); } ?><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/'.$img; ?>" title="<?php echo $title; ?>" /></td></tr><tr id="histd_<?php echo $website->getId(); ?>" class="<?php if ($even) echo 'even'?>" style="display:none"><td colspan="2"><form method="post" id="form_<?php echo $website->getId(); ?>" action="<?php echo Mage::getUrl('*/*/save') ?>" name="form"><input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" /><input type="hidden" value="<?php echo $website->getId(); ?>" name="website" /><div style="float:left;width:330px;"><input type="checkbox" name="status" id="status_<?php echo $website->getId(); ?>" <?php echo !$websiteEnable ? 'disabled' : ''; ?> value="1"<?php echo $product->getId() && $product->getStatus() == Mage_Catalog_Model_Product_Status::STATUS_ENABLED ? ' checked' : ''; ?> /><label for="status_<?php echo $website->getId(); ?>"><?php echo Mage::helper('magesms')->__('Activate displaying SMS opt-out feature in the cart'); ?></label><br /><br /><b><?php echo Mage::helper('magesms')->__('Add SMS product to cart:'); ?></b><br /><input type="radio" name="auto" id="auto1_<?php echo $website->getId(); ?>" <?php echo !$websiteEnable ? 'disabled' : ''; ?> value="1" <?php echo $auto ? 'checked' : ''; ?> /><label for="auto1_<?php echo $website->getId(); ?>"><?php echo Mage::helper('magesms')->__('Automatically'); ?></label><br /><input type="radio" name="auto" id="auto0_<?php echo $website->getId(); ?>" <?php echo !$websiteEnable ? 'disabled' : ''; ?> value="0" <?php echo !$auto ? 'checked' : ''; ?> /><label for="auto0_<?php echo $website->getId(); ?>"><?php echo Mage::helper('magesms')->__('Manually'); ?></label><br /><br /><?php if ($websiteEnable): ?><div style="float:left;"><input type="submit" class="form-button disabled" name="submitOptOut" value="<?php echo Mage::helper('magesms')->__('Save'); ?>" /></div><div style="float:left;padding-left:20px;"><input type="button" onclick="this.form.reset();" class="form-button" title="<?php echo Mage::helper('magesms')->__('Restore unsaved changes to its original state.'); ?>" value="<?php echo Mage::helper('magesms')->__('Cancel'); ?>" /></div><?php endif; ?></div><div style="float:left;"><table class="data"><tr class="headings"><th><?php echo Mage::helper('magesms')->__('Price of SMS'); ?></th><th<?php if (!Mage::app()->isSingleStoreMode()): ?> colspan="2"<?php endif; ?>><?php echo Mage::helper('magesms')->__('Text displayed in the cart'); ?></th></tr><?php $i=0; foreach($website->getStores() as $store): $productStore = Mage::getModel('catalog/product') ->setStoreId($store->getId()) ->load($product->getId()); $storeEnable = Mage::getStoreConfig('magesms/magesms/enable', $store->getId()); ?><tr><?php if ($i++ == 0): ?><td style="vertical-align: middle;" rowspan="<?php echo count($website->getStores());?>"><span class="required">*</span><input type="text" name="price" <?php echo !$websiteEnable ? 'disabled' : ''; ?> class="required-entry validate-zero-or-greater input-text" style="width:60px" value="<?php echo $productStore->getPrice(); ?>" /><strong>[<?php echo $website->getBaseCurrency()->getCode(); ?>]</strong></td><?php endif; ?><?php if (!Mage::app()->isSingleStoreMode()): ?><td><?php echo $store->getName(); ?></td><?php endif; ?><td><span class="required">*</span><input type="text" class="required-entry input-text" <?php echo !$storeEnable ? 'disabled' : ''; ?> name="name[<?php echo $store->getId(); ?>]" style="width:270px" value="<?php echo $this->htmlEscape($productStore->getName()); ?>" /></td></tr><?php endforeach; ?></table></div></form><script type="text/javascript">//<![CDATA[
var sendForm = new varienForm('form_<?php echo $website->getId(); ?>');
//]]></script><br><br><br><br><br><br></td></tr><?php endforeach; ?></table></div></div><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminTools.gif'; ?>" alt="" /> <?php echo Mage::helper('magesms')->__('SMS opt-out - setting Marketing SMS opt-out option for the customer from the user profile'); ?></h4></div><div class="fieldset grid"><form method="post" id="optout_marketing" action="<?php echo Mage::getUrl('*/*/saveOptoutMarketing') ?>" name="form"><input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" /><input type="checkbox" name="status" id="status" value="1"<?php echo $this->getOptoutMarketing() ? ' checked' : ''; ?> /><label for="status"><?php echo Mage::helper('magesms')->__('Activate displaying Marketing SMS opt-out feature in the user profile'); ?></label><input type="submit" class="form-button" name="submitOptoutMarketing" value="<?php echo Mage::helper('magesms')->__('Save'); ?>" /></form></div></div><script type="text/javascript">//<![CDATA[
Event.observe(window, "load", function() {var gridData = document.getElementById('magesms');var tr_array = gridData.getElementsByTagName('tr');for (var i=0, len=tr_array.length; i < len; i++) {if (tr_array[i].className.indexOf('hover') !== -1) {tr_array[i].onmouseover = function() {this.className = this.className + ' on-mouse';};tr_array[i].onmouseout = function() {this.className = this.className.replace(' on-mouse', '');};tr_array[i].onclick = function() {var arr = this.id.split('_');var next = document.getElementById('histd_'+arr[1]);if (next.style.display == 'none') {next.style.display = 'table-row';} else {next.style.display = 'none';}var img = this.getElementsByClassName('img');if (img[0].style.display == 'none') {img[0].style.display = 'inline';} else {img[0].style.display = 'none';}if (img[1].style.display == 'none') {img[1].style.display = 'inline';} else {img[1].style.display = 'none';}};}}<?php if (Mage::app()->isSingleStoreMode()): ?>$$("tr[id*=hist_]")[0].click();<?php else: ?>$("hist_"+window.location.hash.substr(1)).click();<?php endif; ?>});
//]]></script></div>