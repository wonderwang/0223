<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2015 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
 class Topefekt_Magesms_DeliveryController extends Mage_Core_Controller_Front_Action { public function indexAction() { $ia8a35a47a8e61218e15d1a33dac64bdc2449c01a = $this->getRequest(); if ($ia8a35a47a8e61218e15d1a33dac64bdc2449c01a->getParam('test') == 1) { echo 'APISMS123'; } else { $this->fef04b8de4410a42fbb4f182ffb5862871ecca677(); } } private function fef04b8de4410a42fbb4f182ffb5862871ecca677() { $i2e233784f2a54347fff339d5268a637485c8d940 = $this->getRequest(); $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = 0; $i1bb2c0aebfcc8fd150d9defb9c92972136f814de = ''; switch($i2e233784f2a54347fff339d5268a637485c8d940->getParam('status')) { case 1: $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = Topefekt_Magesms_Model_Sms::DELIVERED; break; case 2: $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = Topefekt_Magesms_Model_Sms::UNAVAILABLE; $i1bb2c0aebfcc8fd150d9defb9c92972136f814de = 'waiting in SMS centre for delivery to the recipient'; break; case 3: if (strpos($i2e233784f2a54347fff339d5268a637485c8d940->getParam('message'), 'NDNC') !== false) $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = Topefekt_Magesms_Model_Sms::DND; elseif (strpos($i2e233784f2a54347fff339d5268a637485c8d940->getParam('message'), 'Message duplicity') !== false) $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = Topefekt_Magesms_Model_Sms::DUPLICATE; else $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = Topefekt_Magesms_Model_Sms::ERROR; break; case 9: $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = Topefekt_Magesms_Model_Sms::DND; $i1bb2c0aebfcc8fd150d9defb9c92972136f814de = 'NDNC - Do Not Call Registered Number'; break; case 10: $ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 = 10; break; } if ($ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 == 10) { list($i5a420d261e8d371c89dc6a3697921a0c5a5b5f2f) = explode(';', $i2e233784f2a54347fff339d5268a637485c8d940->getParam('smsdetails')); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab = Mage::getModel('magesms/answers'); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab->setText($i2e233784f2a54347fff339d5268a637485c8d940->getParam('message')); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab->setFrom($i2e233784f2a54347fff339d5268a637485c8d940->getParam('from')); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab->setProhlednuto(0); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab->setSmsc($i5a420d261e8d371c89dc6a3697921a0c5a5b5f2f); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab->setCas(date('Y-m-d h:i:s', Mage::getModel('core/date')->timestamp())); $i2310f34bf75d118b8c0d18d2eaa0515723ce3bab->save(); } elseif ($ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25 > 0) { $i5ee2fa256ff77dd811a9c1911f7563263a694e4b = Mage::getModel('magesms/smshistory')->getCollection() ->addFieldToFilter('smsid', array('like' => $i2e233784f2a54347fff339d5268a637485c8d940->getParam('smsID'))); if (!$i5ee2fa256ff77dd811a9c1911f7563263a694e4b->count()) $i5ee2fa256ff77dd811a9c1911f7563263a694e4b = Mage::getModel('magesms/smshistory')->getCollection() ->addFieldToFilter('smsid', array('like' => '%'.$i2e233784f2a54347fff339d5268a637485c8d940->getParam('smsID').'%')); foreach($i5ee2fa256ff77dd811a9c1911f7563263a694e4b as $i5cd55cefb174b99bf007c9ba882a9d55c1557566) { $i5cd55cefb174b99bf007c9ba882a9d55c1557566->setStatus($ifa7c6fd6ff0baa22538938c920ba5a0f65c25e25); if ($i1bb2c0aebfcc8fd150d9defb9c92972136f814de) $i5cd55cefb174b99bf007c9ba882a9d55c1557566->setNote($i1bb2c0aebfcc8fd150d9defb9c92972136f814de); if ($i2e233784f2a54347fff339d5268a637485c8d940->getParam('price')) $i5cd55cefb174b99bf007c9ba882a9d55c1557566->setPrice($i2e233784f2a54347fff339d5268a637485c8d940->getParam('price')); $i5cd55cefb174b99bf007c9ba882a9d55c1557566->save(); } } } } 