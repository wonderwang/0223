<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2015 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
 class Topefekt_Magesms_Adminhtml_Magesms_AnswersController extends Topefekt_Magesms_Controller_Action { public function indexAction() { $this->_initAction(); $iea2d876101fbc4dc03450ed5474bbd8a6fb905a2 = Mage::helper('adminhtml')->prepareFilterString($this->getRequest()->getParam('filter')); $iea2d876101fbc4dc03450ed5474bbd8a6fb905a2 = $this->_filterDates($iea2d876101fbc4dc03450ed5474bbd8a6fb905a2, array('reg_from', 'reg_to', 'birth_from', 'birth_to')); $ia8a35a47a8e61218e15d1a33dac64bdc2449c01a = new Varien_Object(); foreach ($iea2d876101fbc4dc03450ed5474bbd8a6fb905a2 as $i670253c23c6fcba76bc4256a88fdd8fbc1041039 => $if2eee0665f163a28f4adcfe84e3fc666bf1bcd89) { if (!empty($if2eee0665f163a28f4adcfe84e3fc666bf1bcd89)) { $ia8a35a47a8e61218e15d1a33dac64bdc2449c01a->setData($i670253c23c6fcba76bc4256a88fdd8fbc1041039, $if2eee0665f163a28f4adcfe84e3fc666bf1bcd89); } } $i8ee45e0018a32fb1a855b82624506e35789cc4d2 = $this->getLayout()->createBlock('magesms/answers'); $i8ee45e0018a32fb1a855b82624506e35789cc4d2->setFilterData($ia8a35a47a8e61218e15d1a33dac64bdc2449c01a); $this->getLayout()->getBlock('content')->append($i8ee45e0018a32fb1a855b82624506e35789cc4d2); $this->renderLayout(); return $this; } public function markAsReadAction() { if ($i7d411c0cc32cdb65ec82b9e8d79aa996946f5538 = $this->getRequest()->getParam('id')) { $i0e3e80cee9c51f140b823db0b7df66493acca657 = Mage::getSingleton('adminhtml/session'); $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd = Mage::getModel('magesms/answers') ->load($i7d411c0cc32cdb65ec82b9e8d79aa996946f5538); if (!$i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->getId()) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError(Mage::helper('magesms')->__('Unable to proceed. Please, try again.')); $this->_redirect('*/*/'); return ; } try { $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->setProhlednuto(1) ->save(); $i0e3e80cee9c51f140b823db0b7df66493acca657->addSuccess(Mage::helper('magesms')->__('The message has been marked as read.')); } catch (Mage_Core_Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError($i8c174347956f0a76258a09557543e84f88beb4a0->getMessage()); } catch (Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addException($i8c174347956f0a76258a09557543e84f88beb4a0, Mage::helper('magesms')->__('An error occurred while marking notification as read.')); } $this->_redirectReferer(); return; } $this->_redirect('*/*/'); } public function massMarkAsReadAction() { $i0e3e80cee9c51f140b823db0b7df66493acca657 = Mage::getSingleton('adminhtml/session'); $iea1c44f6137731e1b13c494f784074e6a133577a = $this->getRequest()->getParam('answers'); if (!is_array($iea1c44f6137731e1b13c494f784074e6a133577a)) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError(Mage::helper('magesms')->__('Please select messages.')); } else { try { foreach ($iea1c44f6137731e1b13c494f784074e6a133577a as $i7d411c0cc32cdb65ec82b9e8d79aa996946f5538) { $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd = Mage::getModel('magesms/answers') ->load($i7d411c0cc32cdb65ec82b9e8d79aa996946f5538); if ($i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->getId()) { $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->setProhlednuto(1) ->save(); } } $this->_getSession()->addSuccess( Mage::helper('magesms')->__('Total of %d record(s) have been marked as read.', count($iea1c44f6137731e1b13c494f784074e6a133577a)) ); } catch (Mage_Core_Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError($i8c174347956f0a76258a09557543e84f88beb4a0->getMessage()); } catch (Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addException($i8c174347956f0a76258a09557543e84f88beb4a0, Mage::helper('magesms')->__('An error occurred while marking the messages as read.')); } } $this->_redirect('*/*/'); } public function removeAction() { if ($i7d411c0cc32cdb65ec82b9e8d79aa996946f5538 = $this->getRequest()->getParam('id')) { $i0e3e80cee9c51f140b823db0b7df66493acca657 = Mage::getSingleton('adminhtml/session'); $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd = Mage::getModel('magesms/answers') ->load($i7d411c0cc32cdb65ec82b9e8d79aa996946f5538); if (!$i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->getId()) { $this->_redirect('*/*/'); return ; } try { $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->delete(); $i0e3e80cee9c51f140b823db0b7df66493acca657->addSuccess(Mage::helper('magesms')->__('The message has been removed.')); } catch (Mage_Core_Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError($i8c174347956f0a76258a09557543e84f88beb4a0->getMessage()); } catch (Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addException($i8c174347956f0a76258a09557543e84f88beb4a0, Mage::helper('magesms')->__('An error occurred while removing the message.')); } $this->_redirect('*/*/'); return; } $this->_redirect('*/*/'); } public function massRemoveAction() { $i0e3e80cee9c51f140b823db0b7df66493acca657 = Mage::getSingleton('adminhtml/session'); $iea1c44f6137731e1b13c494f784074e6a133577a = $this->getRequest()->getParam('answers'); if (!is_array($iea1c44f6137731e1b13c494f784074e6a133577a)) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError(Mage::helper('magesms')->__('Please select messages.')); } else { try { foreach ($iea1c44f6137731e1b13c494f784074e6a133577a as $i7d411c0cc32cdb65ec82b9e8d79aa996946f5538) { $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd = Mage::getModel('magesms/answers') ->load($i7d411c0cc32cdb65ec82b9e8d79aa996946f5538); if ($i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->getId()) { $i2e5aa867ea7c6f8ed9ffffe56b63b837364669dd->delete(); } } $this->_getSession()->addSuccess( Mage::helper('magesms')->__('Total of %d record(s) have been removed.', count($iea1c44f6137731e1b13c494f784074e6a133577a)) ); } catch (Mage_Core_Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addError($i8c174347956f0a76258a09557543e84f88beb4a0->getMessage()); } catch (Exception $i8c174347956f0a76258a09557543e84f88beb4a0) { $i0e3e80cee9c51f140b823db0b7df66493acca657->addException($i8c174347956f0a76258a09557543e84f88beb4a0, Mage::helper('magesms')->__('An error occurred while removing messages.')); } } $this->_redirectReferer(); } public function exportCsvAction() { $i76341ee5d8e86027e6fa2d5f6480a85ca10cc6da = 'answers.csv'; $i42cf41da37138d64d37b0778e6561aab5e1239d6 = $this->getLayout()->createBlock('magesms/answers_grid'); $this->_prepareDownloadResponse($i76341ee5d8e86027e6fa2d5f6480a85ca10cc6da, $i42cf41da37138d64d37b0778e6561aab5e1239d6->getCsvFile()); } public function exportExcelAction() { $i76341ee5d8e86027e6fa2d5f6480a85ca10cc6da = 'answers.xml'; $i42cf41da37138d64d37b0778e6561aab5e1239d6 = $this->getLayout()->createBlock('magesms/answers_grid'); $this->_prepareDownloadResponse($i76341ee5d8e86027e6fa2d5f6480a85ca10cc6da, $i42cf41da37138d64d37b0778e6561aab5e1239d6->getExcelFile($i76341ee5d8e86027e6fa2d5f6480a85ca10cc6da)); } protected function _initAction() { parent::_initAction(); $this->_setActiveMenu('magesms/answers') ->_title(Mage::helper('magesms')->__('SMS Answers')) ; return $this; } protected function _isAllowed() { switch ($this->getRequest()->getActionName()) { case 'markAsRead': $i72f3c526b8abf631fb79dfaa1f2cc1e7ee90ca3e = 'magesms/answers/mark_as_read'; break; case 'massMarkAsRead': $i72f3c526b8abf631fb79dfaa1f2cc1e7ee90ca3e = 'magesms/answers/mark_as_read'; break; case 'remove': $i72f3c526b8abf631fb79dfaa1f2cc1e7ee90ca3e = 'magesms/answers/remove'; break; case 'massRemove': $i72f3c526b8abf631fb79dfaa1f2cc1e7ee90ca3e = 'magesms/answers/remove'; break; default: $i72f3c526b8abf631fb79dfaa1f2cc1e7ee90ca3e = 'magesms/answers'; } return Mage::getSingleton('admin/session')->isAllowed($i72f3c526b8abf631fb79dfaa1f2cc1e7ee90ca3e); } } 