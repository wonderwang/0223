<?xml version="1.0"?>
<!--
/**
 * Magegiant
 * 
 * NOTICE OF LICENSE
 * 
 * This source file is subject to the magegiant.com license that is
 * available through the world-wide-web at this URL:
 * http://magegiant.com/license-agreement/
 * 
 * DISCLAIMER
 * 
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 * 
 * @category    Magegiant
 * @package     Magegiant_GiantPoints
 * @copyright   Copyright (c) 2014 Magegiant (http://magegiant.com/)
 * @license     http://magegiant.com/license-agreement/
 */
-->
<config>
    <modules>
        <Magegiant_GiantPoints>
            <version>0.1.2</version>
        </Magegiant_GiantPoints>
    </modules>
    <frontend>
        <routers>
            <giantpoints>
                <use>standard</use>
                <args>
                    <module>Magegiant_GiantPoints</module>
                    <frontName>giantpoints</frontName>
                </args>
            </giantpoints>
        </routers>
        <layout>
            <updates>
                <giantpoints>
                    <file>magegiant/giantpoints.xml</file>
                </giantpoints>
            </updates>
        </layout>
        <translate>
            <modules>
                <Magegiant_GiantPoints>
                    <files>
                        <default>Magegiant_GiantPoints.csv</default>
                    </files>
                </Magegiant_GiantPoints>
            </modules>
        </translate>
    </frontend>
    <admin>
        <routers>
            <giantpointsadmin>
                <use>admin</use>
                <args>
                    <module>Magegiant_GiantPoints</module>
                    <frontName>giantpointsadmin</frontName>
                </args>
            </giantpointsadmin>
        </routers>
    </admin>
    <adminhtml>
        <layout>
            <updates>
                <giantpoints>
                    <file>magegiant/giantpoints.xml</file>
                </giantpoints>
            </updates>
        </layout>
        <translate>
            <modules>
                <Magegiant_GiantPoints>
                    <files>
                        <default>Magegiant_GiantPoints.csv</default>
                    </files>
                </Magegiant_GiantPoints>
            </modules>
        </translate>
        <events>
            <!--<paypal_prepare_line_items>-->
            <!--<observers>-->
            <!--<giantpoints_adminhtml_observers>-->
            <!--<type>singleton</type>-->
            <!--<class>giantpoints/adminhtml_observer</class>-->
            <!--<method>paypalPrepareLineItems</method>-->
            <!--</giantpoints_adminhtml_observers>-->
            <!--</observers>-->
            <!--</paypal_prepare_line_items>-->
            <adminhtml_customer_prepare_save>
                <observers>
                    <giantpoints_update_points>
                        <type>singleton</type>
                        <class>giantpoints/adminhtml_observer</class>
                        <method>applyPointsFromCustomerEdit</method>
                    </giantpoints_update_points>
                    <giantpoints_save_subscription>
                        <type>singleton</type>
                        <class>giantpoints/adminhtml_observer</class>
                        <method>applyPointsNotificationFromCustomerEdit</method>
                    </giantpoints_save_subscription>
                </observers>
            </adminhtml_customer_prepare_save>
            <sales_order_load_after>
                <observers>
                    <giantpoints_adminhtml_observers>
                        <type>singleton</type>
                        <class>giantpoints/adminhtml_observer</class>
                        <method>salesOrderLoadAfter</method>
                    </giantpoints_adminhtml_observers>
                </observers>
            </sales_order_load_after>
            <sales_order_creditmemo_refund>
                <observers>
                    <giantpoints_adminhtml_observers>
                        <type>singleton</type>
                        <class>giantpoints/adminhtml_observer</class>
                        <method>salesOrderCreditmemoRefund</method>
                    </giantpoints_adminhtml_observers>
                </observers>
            </sales_order_creditmemo_refund>
            <controller_action_postdispatch_adminhtml_system_config_save>
                <observers>
                    <giantpoints_system_config_save>
                        <type>singleton</type>
                        <class>giantpoints/adminhtml_observer</class>
                        <method>adminhtmlSystemConfigSave</method>
                    </giantpoints_system_config_save>
                </observers>
            </controller_action_postdispatch_adminhtml_system_config_save>
            <sales_convert_order_to_quote>
                <observers>
                    <giantpoints_convert_order_to_quote>
                        <type>singleton</type>
                        <class>giantpoints/adminhtml_observer</class>
                        <method>salesConvertOrderToQuote</method>
                    </giantpoints_convert_order_to_quote>
                </observers>
            </sales_convert_order_to_quote>
        </events>
    </adminhtml>
    <global>
        <models>
            <giantpoints>
                <class>Magegiant_GiantPoints_Model</class>
                <resourceModel>giantpoints_mysql4</resourceModel>
            </giantpoints>
            <giantpoints_mysql4>
                <class>Magegiant_GiantPoints_Model_Mysql4</class>
                <entities>
                    <customer>
                        <table>giant_points_customer</table>
                    </customer>
                    <transaction>
                        <table>giant_points_transaction</table>
                    </transaction>
                    <rate>
                        <table>giant_points_rate</table>
                    </rate>
                    <rule>
                        <table>giant_points_behavior_rule</table>
                    </rule>
                </entities>
            </giantpoints_mysql4>
            <sendfriend>
                <rewrite>
                    <sendfriend>Magegiant_GiantPoints_Model_Sendfriend_Rewrite_Sendfriend</sendfriend>
                </rewrite>
            </sendfriend>
            <adminhtml>
                <rewrite></rewrite>
                <drewrite>
                    <config_data>Magegiant_GiantPoints_Model_Adminhtml_Config_Rewrite_Data</config_data>
                </drewrite>
            </adminhtml>
        </models>
        <resources>
            <giantpoints_setup>
                <setup>
                    <module>Magegiant_GiantPoints</module>
                    <class>Magegiant_GiantPoints_Model_Mysql4_Setup</class>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </giantpoints_setup>
            <giantpoints_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </giantpoints_write>
            <giantpoints_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </giantpoints_read>
        </resources>
        <blocks>
            <giantpoints>
                <class>Magegiant_GiantPoints_Block</class>
            </giantpoints>
        </blocks>
        <helpers>
            <giantpoints>
                <class>Magegiant_GiantPoints_Helper</class>
            </giantpoints>
        </helpers>
        <!--Email template config-->
        <template>
            <email>
                <giantpoints_email_update_balance translate="label" module="giantpoints">
                    <label>Points and Rewards Balance Update</label>
                    <file>giantpoints/balance_update.html</file>
                    <type>html</type>
                </giantpoints_email_update_balance>
                <giantpoints_email_before_expire_transaction translate="label" module="giantpoints">
                    <label>Points and Rewards Expiration Warning</label>
                    <file>giantpoints/expiration_warning.html</file>
                    <type>html</type>
                </giantpoints_email_before_expire_transaction>
                <giantpoints_group_customer_birthday_email_template translate="label" module="giantpoints">
                    <label>Points and Rewards Customer Birthday</label>
                    <file>giantpoints/birthday_notification.html</file>
                    <type>html</type>
                </giantpoints_group_customer_birthday_email_template>
            </email>
        </template>
        <!--End Email config-->
        <!-- Giant Points Total Quote Config -->
        <sales>
            <quote>
                <totals>
                    <giantpoints_earning>
                        <class>giantpoints/total_quote_earning</class>
                        <renderer>giantpoints/checkout_cart_renderer_point</renderer>
                        <after>wee,discount,tax,tax_subtotal,grand_total,giantpoints_spending</after>
                        <admin_renderer>giantpoints/adminhtml_checkout_cart_renderer_point</admin_renderer>
                    </giantpoints_earning>
                    <giantpoints_spending>
                        <class>giantpoints/total_quote_spending</class>
                        <after>wee,discount,tax,tax_subtotal,grand_total</after>
                    </giantpoints_spending>
                </totals>
            </quote>
            <order_invoice>
                <totals>
                    <giantpoints>
                        <class>giantpoints/total_invoice_point</class>
                        <after>grand_total</after>
                    </giantpoints>
                </totals>
            </order_invoice>
            <order_creditmemo>
                <totals>
                    <giantpoints>
                        <class>giantpoints/total_creditmemo_point</class>
                        <after>grand_total</after>
                    </giantpoints>
                </totals>
            </order_creditmemo>
        </sales>
        <pdf>
            <totals>
                <discount translate="title">
                    <title>Discount</title>
                    <source_field>discount_amount</source_field>
                    <model>giantpoints/total_pdf_discount</model>
                    <font_size>7</font_size>
                    <display_zero>0</display_zero>
                    <sort_order>251</sort_order>
                </discount>
                <giantpoints_discount translate="title">
                    <title>Discount</title>
                    <source_field>discount_amount</source_field>
                    <model>giantpoints/total_pdf_spending</model>
                    <amount_prefix>-</amount_prefix>
                    <font_size>8</font_size>
                    <display_zero>0</display_zero>
                    <sort_order>252</sort_order>
                </giantpoints_discount>
                <giantpoints_earn translate="title">
                    <title>Earned points</title>
                    <source_field>giantpoints_earn</source_field>
                    <model>giantpoints/total_pdf_earning</model>
                    <font_size>7</font_size>
                    <display_zero>0</display_zero>
                    <sort_order>1000</sort_order>
                </giantpoints_earn>
            </totals>
        </pdf>
        <fieldsets>
            <sales_convert_quote_address>
                <giantpoints_earn>
                    <to_order>*</to_order>
                </giantpoints_earn>
                <invitee_earn>
                    <to_order>*</to_order>
                </invitee_earn>
                <referral_id>
                    <to_order>*</to_order>
                </referral_id>
                <referral_earn>
                    <to_order>*</to_order>
                </referral_earn>
                <giantpoints_spent>
                    <to_order>*</to_order>
                </giantpoints_spent>
                <giantpoints_base_discount>
                    <to_order>*</to_order>
                </giantpoints_base_discount>
                <giantpoints_discount>
                    <to_order>*</to_order>
                </giantpoints_discount>
            </sales_convert_quote_address>
            <sales_convert_quote_item>
                <giantpoints_earn>
                    <to_order_item>*</to_order_item>
                </giantpoints_earn>
                <invitee_earn>
                    <to_order_item>*</to_order_item>
                </invitee_earn>
                <referral_earn>
                    <to_order_item>*</to_order_item>
                </referral_earn>
                <giantpoints_spent>
                    <to_order_item>*</to_order_item>
                </giantpoints_spent>
                <giantpoints_base_discount>
                    <to_order_item>*</to_order_item>
                </giantpoints_base_discount>
                <giantpoints_discount>
                    <to_order_item>*</to_order_item>
                </giantpoints_discount>
            </sales_convert_quote_item>
        </fieldsets>
        <!--End Total Quote Config-->
        <giantpoints>
            <!--Point Action-->
            <actions>
                <!--Order-->
                <order_invoiced>giantpoints/actions_earning_orderInvoiced</order_invoiced>
                <order_refunded>giantpoints/actions_earning_orderRefunded</order_refunded>
                <change_by_admin>giantpoints/actions_changeByAdmin</change_by_admin>
                <spending_order>giantpoints/actions_spending_order</spending_order>
                <spending_cancel>giantpoints/actions_spending_cancel</spending_cancel>
                <spending_creditmemo>giantpoints/actions_spending_creditmemo</spending_creditmemo>
            </actions>
            <!--/Point Action-->
        </giantpoints>
        <events>
            <!-- Giantpoints process order -->
            <sales_order_save_after>
                <observers>
                    <giantpoints_observers>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>salesOrderSaveAfter</method>
                    </giantpoints_observers>
                </observers>
            </sales_order_save_after>
            <sales_order_invoice_save_after>
                <observers>
                    <giantpoints_observers>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>salesOrderInvoiceSaveAfter</method>
                    </giantpoints_observers>
                </observers>
            </sales_order_invoice_save_after>
            <adminhtml_sales_order_creditmemo_register_before>
                <observers>
                    <giantpoints_observers>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>salesOrderCreditmemoRegisterBefore</method>
                    </giantpoints_observers>
                </observers>
            </adminhtml_sales_order_creditmemo_register_before>
            <sales_order_creditmemo_save_after>
                <observers>
                    <giantpoints_observers>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>salesOrderCreditmemoSaveAfter</method>
                    </giantpoints_observers>
                </observers>
            </sales_order_creditmemo_save_after>
            <core_block_abstract_to_html_after>
                <observers>
                    <giantpoints_observer_block_output>
                        <type>singleton</type>
                        <class>giantpoints/block_observer</class>
                        <method>afterOutputHtml</method>
                    </giantpoints_observer_block_output>
                </observers>
            </core_block_abstract_to_html_after>
            <sales_model_service_quote_submit_after>
                <observers>
                    <giantpoints_observers>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>salesOrderPlaceAfter</method>
                    </giantpoints_observers>
                </observers>
            </sales_model_service_quote_submit_after>
            <checkout_onepage_controller_success_action>
                <observers>
                    <points_checkout_success>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>quoteDestroy</method>
                    </points_checkout_success>
                </observers>
            </checkout_onepage_controller_success_action>
            <customer_save_before>
                <observers>
                    <customer_save_observer>
                        <type>singleton</type>
                        <class>giantpoints/observer</class>
                        <method>customerSaveBefore</method>
                    </customer_save_observer>
                </observers>
            </customer_save_before>
            <controller_action_postdispatch_customer_account_createpost>
                <observers>
                    <giantpoints_postdispatch_customer_account_createpost>
                        <class>giantpoints/observer</class>
                        <method>postdispatchCustomerAccountCreatePost</method>
                    </giantpoints_postdispatch_customer_account_createpost>
                </observers>
            </controller_action_postdispatch_customer_account_createpost>
            <controller_action_postdispatch_checkout_onepage_saveOrder>
                <observers>
                    <giantpoints_postdispatch_checkout_onepage_saveOrder>
                        <class>giantpoints/observer</class>
                        <method>postdispatchCustomerAccountCreatePost</method>
                    </giantpoints_postdispatch_checkout_onepage_saveOrder>
                </observers>
            </controller_action_postdispatch_checkout_onepage_saveOrder>
            <controller_action_predispatch>
                <observers>
                    <giantpoints_observers_predispatch>
                        <class>giantpoints/observer</class>
                        <method>pageLoadBeforeFront</method>
                    </giantpoints_observers_predispatch>
                </observers>
            </controller_action_predispatch>
        </events>
    </global>
    <default>
        <giantpoints>
            <!--=====System Configuration=====-->
            <general>
                <enable>1</enable>
                <point_label><![CDATA[ Point]]></point_label>
                <plural_point_label><![CDATA[ Points]]></plural_point_label>
                <point_label_position>1</point_label_position>
                <dashboard_label>My Points and Rewards</dashboard_label>
                <show_point_icon>1</show_point_icon>
                <point_icon>default/point.png</point_icon>
                <show_info_page>0</show_info_page>
                <zero_points>zero points</zero_points>
            </general>
            <earning>
                <rounding_method>round</rounding_method>
                <calculate_points_order>1</calculate_points_order>
                <by_tax>0</by_tax>
                <by_shipping>0</by_shipping>
                <order_invoice>1</order_invoice>
                <cancel_earned_points_on_order_refund>1</cancel_earned_points_on_order_refund>
                <order_invoice>1</order_invoice>
                <calculate_points_order>2</calculate_points_order>
            </earning>
            <spending>
                <discount_label>Reward Points</discount_label>
                <calculate_spending_points_order>1</calculate_spending_points_order>
                <spend_for_tax>1</spend_for_tax>
                <spend_for_shipping>1</spend_for_shipping>
                <spend_for_shipping_tax>1</spend_for_shipping_tax>
                <refund_spent_points_on_order_refund>1</refund_spent_points_on_order_refund>
                <calculate_spending_points_order>2</calculate_spending_points_order>
            </spending>
            <display>
                <toplinks>1</toplinks>
                <top_dashboard>1</top_dashboard>
                <product>1</product>
                <checkout_cart>0</checkout_cart>
                <product_list>1</product_list>
                <minicart>1</minicart>
                <show_social_earn_message>1</show_social_earn_message>
            </display>
            <design>
                <slider_style>#3399cc</slider_style>
                <slider_width>150</slider_width>
            </design>
            <email>
                <enable>1</enable>
                <sender>general</sender>
                <update_balance>giantpoints_email_update_balance</update_balance>
                <before_expire_transaction>giantpoints_email_before_expire_transaction</before_expire_transaction>
                <before_expire_days>7</before_expire_days>
            </email>
            <!--=========End System========-->
        </giantpoints>
    </default>
    <crontab>
        <jobs>
            <giantpoints_expire_transaction>
                <schedule>
                    <cron_expr>1 1 * * *</cron_expr>
                </schedule>
                <run>
                    <model>giantpoints/cron::processTransactions</model>
                </run>
            </giantpoints_expire_transaction>
        </jobs>
    </crontab>
</config>